<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MKT4X VIRTUAL | Official Portal</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
:root{
  --mint-primary:#A8E6CF; --mint-soft:#E8FFF8; --mint-accent:#5CD6C0;
  --mint-dark:#2F4F4F; --white:#ffffff; --shadow:rgba(92,214,192,0.3);
}
*{box-sizing:border-box;}
body{margin:0;font-family:'Inter',sans-serif;background:linear-gradient(180deg,#E8FFF8 0%,#ffffff 100%);color:var(--mint-dark);overflow-x:hidden;}
.navbar{display:flex;justify-content:space-between;align-items:center;padding:15px 5%;background:var(--white);box-shadow:0 5px 20px var(--shadow);position:sticky;top:0;z-index:1000;height:70px;}
.logo img{height:32px;}
.nav-right{display:flex;align-items:center;gap:20px;}
.menu-btn{cursor:pointer;display:flex;flex-direction:column;gap:4px;z-index:10001;}
.menu-btn span{width:22px;height:2px;background:var(--mint-dark);}
.sidebar{position:fixed;top:0;right:-280px;width:280px;height:100vh;background:var(--white);border-left:2px solid var(--mint-primary);transition:0.3s ease;z-index:9999;padding:80px 30px;box-shadow:-10px 0 30px var(--shadow);}
.sidebar.active{right:0;}
.sidebar ul{list-style:none;padding:0;}
.sidebar ul li{margin-bottom:25px;}
.sidebar ul li a{color:var(--mint-dark);text-decoration:none;display:flex;align-items:center;gap:15px;}
.sidebar ul li a:hover{color:var(--mint-accent);}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(168,230,207,0.4);backdrop-filter:blur(4px);display:none;z-index:9998;}
.overlay.active{display:block;}
#profileContainer{display:none;text-align:center;margin-top:20px;}
#profileContainer img{width:60px;height:60px;border-radius:50%;margin-bottom:5px;}
#profileContainer button{padding:5px 10px;border:none;border-radius:5px;background:#5CD6C0;color:white;cursor:pointer;}
#authModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;justify-content:center;align-items:center;}
#authModal div{background:white;padding:20px;border-radius:15px;max-width:400px;width:90%;display:flex;flex-direction:column;}
#authModal input{margin-bottom:10px;padding:10px;border:1px solid #ccc;border-radius:8px;}
#authModal button{padding:10px;border:none;border-radius:8px;cursor:pointer;}
#authModal button.google{background:#4285F4;color:white;}
#authModal button.close{background:#ccc;margin-top:10px;}
</style>
</head>
<body>

<div class="overlay" id="overlay"></div>

<nav class="navbar">
  <div class="logo"><img src="https://i.imgur.com/yq2JRbl.png" alt="Logo"></div>
  <div class="nav-right">
    <div class="menu-btn" id="menuBtn"><span></span><span></span><span></span></div>
  </div>
</nav>

<div class="sidebar" id="sidebar">
  <ul>
    <li><a href="#">Berita</a></li>
    <li><a href="#">Jadwal</a></li>
    <li><a href="#">Member</a></li>
    <li><a href="#">Setlist</a></li>
    <hr style="opacity:0.1; margin:20px 0;">
    <li><a href="#" class="reg-link">Fanclub</a></li>
    <li><a href="#" id="authBtn">Masuk</a></li>
  </ul>
  <div id="profileContainer">
    <img id="profilePic" src="" alt="Profil">
    <p id="profileName"></p>
    <button onclick="editProfile()">Edit Profil</button>
  </div>
</div>

<!-- AUTH MODAL -->
<div id="authModal">
  <div>
    <input id="name" placeholder="Nama">
    <input id="username" placeholder="Username">
    <input id="email" placeholder="Email">
    <input id="password" placeholder="Password" type="password">
    <button id="registerBtn">Register</button>
    <button class="google" id="googleLoginBtn">Login dengan Google</button>
    <button class="close" id="closeModal">Tutup</button>
  </div>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import { createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-auth.js";
import { doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-firestore.js";

// UI
const menuBtn = document.getElementById("menuBtn");
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
const authBtn = document.getElementById("authBtn");
const authModal = document.getElementById("authModal");
const closeModalBtn = document.getElementById("closeModal");
const registerBtn = document.getElementById("registerBtn");
const googleBtn = document.getElementById("googleLoginBtn");
const profileContainer = document.getElementById("profileContainer");
const profileName = document.getElementById("profileName");
const profilePic = document.getElementById("profilePic");

// SIDEBAR TOGGLE
menuBtn.addEventListener("click", ()=>{
  sidebar.classList.toggle("active");
  overlay.classList.toggle("active");
});
overlay.addEventListener("click", ()=>{
  sidebar.classList.remove("active");
  overlay.classList.remove("active");
});

// MODAL
authBtn.addEventListener("click", e=>{
  e.preventDefault();
  if(auth.currentUser) signOut(auth);
  else authModal.style.display="flex";
});
closeModalBtn.addEventListener("click", ()=> authModal.style.display="none");

// REGISTER
registerBtn.addEventListener("click", async ()=>{
  const name = document.getElementById("name").value;
  const username = document.getElementById("username").value;
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  if(!name||!username||!email||!password) return alert("Isi semua field!");
  try{
    const userCredential = await createUserWithEmailAndPassword(auth,email,password);
    await setDoc(doc(db,"users",userCredential.user.uid), {name, username, email, role:"member", createdAt:new Date()});
    authModal.style.display="none";
  }catch(err){ alert(err.message); }
});

// GOOGLE LOGIN
googleBtn.addEventListener("click", async ()=>{
  const provider = new GoogleAuthProvider();
  try{
    const result = await signInWithPopup(auth,provider);
    const user = result.user;
    const docRef = doc(db,"users",user.uid);
    const docSnap = await getDoc(docRef);
    if(!docSnap.exists()){
      await setDoc(docRef,{name:user.displayName||"Google User", username:user.email.split("@")[0], email:user.email, role:"member", createdAt:new Date()});
    }
    authModal.style.display="none";
  }catch(err){ alert(err.message); }
});

// EDIT PROFILE
window.editProfile = async ()=>{
  const newName = prompt("Nama baru:", profileName.innerText);
  if(newName){
    profileName.innerText = newName;
    if(auth.currentUser) await setDoc(doc(db,"users",auth.currentUser.uid),{name:newName},{merge:true});
  }
};

// AUTH STATE
onAuthStateChanged(auth, async user=>{
  if(user){
    profileContainer.style.display="block";
    const docSnap = await getDoc(doc(db,"users",user.uid));
    profileName.innerText = docSnap.exists()? docSnap.data().name : user.displayName||user.email;
    profilePic.src = "https://i.pravatar.cc/150?u="+user.uid;
    authBtn.innerText="Logout";
  } else {
    profileContainer.style.display="none";
    authBtn.innerText="Masuk";
  }
});
</script>

</body>
</html>
